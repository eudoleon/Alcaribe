<odoo>
  <data>

    <record model="ir.ui.view" id="view_tax_form_inherited">
      <field name="name">account.tax.form.inherited</field>
      <field name="model">account.tax</field>
      <field name="inherit_id" ref="account.view_tax_form" />
      <field name="arch" type="xml">

        <xpath expr="//group/field[@name='tax_scope']" position="after">
          <field
            name="withholding_type"
            attrs="{'invisible':[('amount_type', 'not in', ('fixed', 'percent', 'division'))]}" />
        </xpath>

      </field>
    </record>

    <record id="view_move_form_inherit" model="ir.ui.view">
      <field name="name">account.move.form.inherit</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_move_form" />
      <field name="arch" type="xml">
        <xpath expr="//group/field[@name='date']" position="after">
          <field name="tsc_tax_withholding_date" string="Tax withholding date"
            attrs="{
                  'invisible': [('move_type', 'in', ('out_invoice', 'out_refund', 'out_receipt'))],
                  'readonly': [('state', '!=', 'draft')],
              }" />
        </xpath>

        <field name="invoice_vendor_bill_id" position="after">
          <field name="invoice_tax_id"
            attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))], 'readonly': [('state', '!=', 'draft')]}" />
          <field name="sequence_withholding_iva" invisible="1" />
          <field name="sequence_withholding_islr" invisible="1" />
        </field>

        <div name="journal_div" position="after">
          <field name="reference_number"
            attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))]}" />
          <field name="invoice_control_number"
            attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))]}" />
        </div>

        <xpath expr="//sheet/notebook/page/field/tree/field[@name='tax_ids']" position="attributes">
          <attribute name="domain">
            [
            ('type_tax_use', '=?', parent.invoice_filter_type_domain),
            ('company_id', '=', parent.company_id),
            ('country_id', '=', parent.tax_country_id),
            ('withholding_type', '!=', 'iva')
            ]
          </attribute>
        </xpath>

        <xpath expr="//sheet/notebook/page/field/tree/field[@name='tax_ids']" position="after">
          <field name="tsc_cod_retencion_islr"
            attrs="{'column_invisible': [('parent.move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))]}" />
        </xpath>

        <field name="tax_totals" position="before">
          <field name="subtracting" widget='monetary' colspan="2"
            attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))], 'readonly': [('state', '!=', 'draft')]}" />
        </field>

        <button name="action_register_payment" type="object" position="after">
          <button name="generate_withholding_iva" type="object" string="Generate VAT withholding"
            groups="account.group_account_user"
            attrs="{'invisible': ['|', ('sequence_withholding_iva', '!=', False), ('state', '!=', 'posted')]}"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" />
          <button name="generate_withholding_islr" type="object" string="Generate ISLR Withholding"
            groups="account.group_account_user"
            attrs="{'invisible': ['|', ('sequence_withholding_islr', '!=', False), ('state', '!=', 'posted')]}"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" />
        </button>

      </field>
    </record>

    <record id="purchase_order_form_inherit" model="ir.ui.view">
      <field name="name">purchase.order.form.inherit</field>
      <field name="model">purchase.order</field>
      <field name="inherit_id" ref="purchase.purchase_order_form" />
      <field name="arch" type="xml">

        <xpath expr="//sheet/notebook/page/field/tree/field[@name='taxes_id']" position="attributes">
          <attribute name="domain">
            [
            ('type_tax_use','=','purchase'),
            ('company_id', '=', parent.company_id),
            ('country_id', '=', parent.tax_country_id),
            ('withholding_type', '!=', 'iva')
            ]
          </attribute>
        </xpath>

      </field>
    </record>

    <record id="view_invoice_tree_inherit" model="ir.ui.view">
      <field name="name">account.invoice.tree.inherit</field>
      <field name="model">account.move</field>
      <field name="inherit_id" ref="account.view_invoice_tree" />
      <field name="arch" type="xml">

        <button name="action_register_payment" type="object" position="after">
          <button name="generate_withholding_iva" type="object" string="Generate VAT withholding"
            groups="account.group_account_user"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" />
          <button name="generate_withholding_islr" type="object" string="Generate ISLR Withholding"
            groups="account.group_account_user"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')" />
        </button>

        <field name="name" position="after">
          <field name="reference_number" optional="show"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')"
            groups="base.group_user" />
          <field name="invoice_control_number" optional="show"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')"
            groups="base.group_user" />
        </field>

        <field name="ref" position="after">
          <field name="withholding_iva" optional="show"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')"
            groups="base.group_user" sum="Total VAT Withholding" />
          <field name="sequence_withholding_iva" optional="show"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')"
            groups="base.group_user" />
          <field name="withholding_islr" optional="show"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')"
            groups="base.group_user" sum="Total ISLR Withholding" />
          <field name="sequence_withholding_islr" optional="show"
            invisible="context.get('default_move_type') not in ('in_invoice', 'in_refund','in_receipt')"
            groups="base.group_user" />
        </field>

      </field>
    </record>

  </data>

  <data noupdate="1">
    <record id="secuence_move_withholding_iva" model="ir.sequence">
      <field name="name">VAT withholding sequence</field>
      <field name="code">account.move.withholding.iva</field>
      <field name="number_next_actual">1</field>
      <field name="padding">1</field>
    </record>

    <record id="secuence_move_withholding_islr" model="ir.sequence">
      <field name="name">ISLR withholding sequence</field>
      <field name="code">account.move.withholding.islr</field>
      <field name="number_next_actual">1</field>
      <field name="padding">1</field>
    </record>
  </data>

</odoo>